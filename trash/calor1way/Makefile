# Makefile generated by Prepalm user miguel, date : Tue Nov 15 13:36:02 CST 2016
# 
# Compiling and linking commands and options for driver units and blocks

include Make.include
 
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# in Make.include file, you must define some variables :
#
# PALMHOME        : Palm home (palm library path)
#
# F90             : Fortran 90 compiler
# F90FLAGS        : Fortran 90 compiler flags
# LF90FLAGS       : Fortran 90 linker flags
# F90EXTLIB       : Fortran 90 linker ext. lib.
#
# F77             : Fortran 77 compiler
# F77FLAGS        : Fortran 77 compiler flags
# LF77FLAGS       : Fortran 77 linker flags
# F77EXLIB        : Fortran 77 linker ext. lib.
#
# FPPFLAGS        : Fortran 77&90 preprocessor
#
# CC              : C compiler
# CCFLAGS         : C compiler flags
# LCCFLAGS        : C linker flags
# CCEXTLIB        : C linker ext. lib.
#
# C++             : C++ compiler
# C++FLAGS        : C++ compiler flags
# LC++FLAGS       : C++ linker flags
# C++EXTLIB       : C++ linker ext. lib.
#
# OMPFLAGS        : Openmp flags
#
# SOFLAGS         : Dynamic library flags
#
# INCLUDES        : External include dir
# LIBS            : External library
#
# PYTHON          : Python command
# CYTHON          : Cython command
# PYTHON_INCLUDE  : Python include dir
# MPI4PY_INCLUDE  : Mpi4py include dir
# NUMPY_INCLUDE   : Numpy include dir
#
# USERINCF        : User Make inc. file bef. SUFFIXES
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
EXECS = palm_main  main_condiciones main_solver main_solver2 main_vecteur_print

# 
PATH_LIBPALM= $(PALMHOME)/lib
LIBPALM= -lpalm
INCPALM= -I$(PALMHOME)/include
PATH_LIBDRV= $(PALMHOME)/lib
LIBDRV= -ldrv
LIBDTM= -ldtm
SO_SERV= 
DRVSERV= palm_user_param.o palm_driver_services.o palm_driver_servicesc.o palm_init.o  
ENTSERV= palm_user_param.o palm_entities_services.o palm_entities_servicesc.o palm_init.o palm_debug.o 
OMPSERV= 
LIB_PALM_SO   = $(PALMHOME)/lib/libpalm_so.so
 
all : $(EXECS) $(SO_SERV)
 
palm_main : $(DRVSERV)
	$(F90) $(LF90FLAGS) -L$(PATH_LIBDRV) -o $@ $(DRVSERV) $(PATH_LIBDRV)/drv_main.o  $(LIBS) $(LIBDRV) $(F90EXTLIB) 
 
dtm.exe : $(DRVSERV)
	$(F90) $(LF90FLAGS) -L$(PATH_LIBDRV) -o dtm.exe $(DRVSERV) $(PATH_LIBDRV)/dtm_slave_main.o $(LIBS) $(LIBDTM) $(LIBDRV) $(F90EXTLIB)
 
palm.so : $(SO_SERV) palm.pyx
	echo ***** librairie pour python **** 
	$(CYTHON) -I${MPI4PY_INCLUDE} -I${NUMPY_INCLUDE} $(INCPALM) palm.pyx
	$(CC) -c $(SOFLAGS) -I${PYTHON_INCLUDE} -I${MPI4PY_INCLUDE} -I${NUMPY_INCLUDE} $(INCPALM) palm.c -o palm.o
	$(CC) $(SOFLAGS) palm.o $(LIB_PALM_SO) $(SO_SERV)  $(CCEXTLIB) -o palm.so
main_condiciones : $(ENTSERV) main_condiciones.o condiciones.o globaldata.o 
	$(F90)  $(LF90FLAGS) -L$(PATH_LIBPALM) -o main_condiciones $(ENTSERV) main_condiciones.o  condiciones.o globaldata.o   $(LIBS) $(LIBPALM) $(F90EXTLIB)
 
main_solver : $(ENTSERV) main_solver.o solver.o globaldata.o 
	$(F90)  $(LF90FLAGS) -L$(PATH_LIBPALM) -o main_solver $(ENTSERV) main_solver.o  solver.o globaldata.o   $(LIBS) $(LIBPALM) $(F90EXTLIB)
 
main_solver2 : $(ENTSERV) main_solver2.o solver2.o globaldata.o 
	$(F90)  $(LF90FLAGS) -L$(PATH_LIBPALM) -o main_solver2 $(ENTSERV) main_solver2.o  solver2.o globaldata.o   $(LIBS) $(LIBPALM) $(F90EXTLIB)
 
main_vecteur_print : $(ENTSERV) main_vecteur_print.o vecteur_print.o 
	$(F90)  $(LF90FLAGS) -L$(PATH_LIBPALM) -o main_vecteur_print $(ENTSERV) main_vecteur_print.o  vecteur_print.o   $(LIBS) $(LIBPALM) $(F90EXTLIB)
 
clean :
	\rm -f $(EXECS) dtm.exe *.o *.log *~ core* *.mod *.lo *.so put_PORT*

allclean : clean
	\rm -f Palm_XML.cpp Palm_XML.h run_mpi1.sh palm_*_services.f90 palm_*_servicesc.c main_* main_*.c *.pil palm_user_param*.* palm_init.c *.fout palm_needed_files.txt *.recover Makefile palm.c palm.pyx PCW.c PCW.pyx *.pyc

objclean : clean
	\rm -f 

tidy :
	\rm -f *.log *~ core*  *.fout put_PORT*

.SUFFIXES : .F90 .f90 .F .f .c .cc .C .c++ .cpp .o .lo
.f90.o :
	$(F90) $(INCLUDES) $(INCPALM) $(F90FLAGS) $(OMPFLAGS) -c $< -o $@

.f90.lo :
	$(F90) $(INCLUDES) $(INCPALM) $(F90FLAGS) $(SOFLAGS) $(OMPFLAGS) -c $< -o $@

.F90.o :
	$(F90) $(FPPFLAGS) $(INCLUDES) $(INCPALM) $(F90FLAGS) $(OMPFLAGS) -c $< -o $@

.F90.lo :
	$(F90) $(FPPFLAGS) $(INCLUDES) $(INCPALM) $(F90FLAGS) $(SOFLAGS) $(OMPFLAGS) -c $< -o $@

.f.o :
	$(F77) $(INCLUDES) $(INCPALM) $(F77FLAGS) $(OMPFLAGS) -c $< -o $@

.f.lo :
	$(F77) $(INCLUDES) $(INCPALM) $(F77FLAGS) $(SOFLAGS) $(OMPFLAGS) -c $< -o $@

.F.o :
	$(F77) $(FPPFLAGS) $(INCLUDES) $(INCPALM) $(F77FLAGS) $(OMPFLAGS) -c $< -o $@

.F.lo :
	$(F77) $(FPPFLAGS) $(INCLUDES) $(INCPALM) $(F77FLAGS) $(SOFLAGS) $(OMPFLAGS) -c $< -o $@

.c.o:
	$(CC) $(INCLUDES) $(INCPALM) $(CCFLAGS) -c $< -o $@

.c.lo:
	$(CC) $(INCLUDES) $(INCPALM) $(CCFLAGS) $(SOFLAGS) -c $< -o $@

.cc.o .C.o .c++.o .cpp.o:
	$(C++) $(INCLUDES) $(INCPALM) $(C++FLAGS) -c $< -o $@
